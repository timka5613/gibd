<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ГИБДД ОРЛС</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .sidebar { width: 250px; min-height: 100vh; }
        .main-content { width: calc(100% - 250px); min-height: 100vh; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal {
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .question-item {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .question-item button {
            margin-left: 0.5rem;
        }
        .rank-image {
            width: 30px; /* Adjust size as needed */
            height: auto;
        }
    </style>
</head>
<body id="panel-page" class="flex bg-gray-100">

    <div id="specialCodeModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4 text-center">Подтверждение</h2>
            <form id="specialCodeForm">
                <div class="mb-4">
                    <label for="specialCodeInput" class="block text-gray-700 font-bold mb-2">Введите специальный код:</label>
                    <input type="password" id="specialCodeInput" name="specialCode" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Подтвердить</button>
                </div>
            </form>
        </div>
    </div>

    <div class="sidebar bg-white p-6 shadow-lg flex flex-col justify-between hidden">
        <div class="flex-grow">
            <h1 class="text-2xl font-bold mb-6 text-center">ГИБДД</h1>
            <ul id="sidebar-menu">
                <li class="mb-2">
                    <a href="#" onclick="showTab('dashboard')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-home mr-3"></i>Панель управления
                    </a>
                </li>
                <li id="manageStaffLink" class="mb-2">
                    <a href="#" onclick="showTab('manage-staff')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-users mr-3"></i>Управление составом
                    </a>
                </li>
                <li id="manageCertificationsLink" class="mb-2">
                    <a href="#" onclick="showTab('manage-certifications')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-certificate mr-3"></i>Управление аттестациями
                    </a>
                </li>
                <li id="manageParadesLink" class="mb-2">
                    <a href="#" onclick="showTab('manage-parades')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-bullhorn mr-3"></i>Управление строями
                    </a>
                </li>
                <li id="manageCandidatesLink" class="mb-2">
                    <a href="#" onclick="showTab('manage-candidates')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-user-plus mr-3"></i>Кандидаты на начальника
                    </a>
                </li>
                <li id="certificationResultsLink" class="mb-2">
                    <a href="#" onclick="showTab('certification-results')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-award mr-3"></i>Результаты аттестаций
                    </a>
                </li>
                <li id="reportsLink" class="mb-2">
                    <a href="#" onclick="showTab('reports')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-file-alt mr-3"></i>Мои отчеты и неактивы
                    </a>
                </li>
                <li id="orlsReportsLink" class="mb-2">
                    <a href="#" onclick="showTab('orls-reports')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-folder-open mr-3"></i>Заявления и неактивы
                    </a>
                </li>
                <li id="weeklyReportsLink" class="mb-2">
                    <a href="#" onclick="showTab('weekly-reports')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-chart-line mr-3"></i>Отчеты за неделю
                    </a>
                </li>
                <li id="certificationLink" class="mb-2">
                    <a href="#" onclick="showTab('certification')" class="flex items-center text-gray-700 hover:bg-gray-200 p-2 rounded-lg">
                        <i class="fas fa-clipboard-check mr-3"></i>Пройти аттестацию
                    </a>
                </li>
            </ul>
        </div>
        <div class="mt-4 border-t pt-4">
            <div class="flex items-center">
                <i class="fas fa-user-circle text-2xl mr-3 text-gray-500"></i>
                <div>
                    <p id="userName" class="font-bold">Имя пользователя</p>
                    <p id="userRole" class="text-sm text-gray-500">Роль</p>
                </div>
            </div>
            <a href="#" onclick="logout()" class="mt-2 block w-full text-center bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition duration-200">Выйти</a>
        </div>
    </div>

    <div class="main-content p-8 overflow-y-auto hidden">
        <h1 class="text-3xl font-bold mb-6">Панель управления</h1>

        <div id="dashboard" class="tab-content active">
            <h2 class="text-xl font-bold mb-4">Обзор</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700">Всего аккаунтов</h3>
                    <p id="totalAccounts" class="text-3xl font-bold text-blue-500 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700">Всего тестов</h3>
                    <p id="totalTests" class="text-3xl font-bold text-green-500 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700">Пройдено аттестаций</h3>
                    <p id="completedCertifications" class="text-3xl font-bold text-purple-500 mt-2">0</p>
                </div>
            </div>
            <h2 class="text-xl font-bold mb-4">Предстоящие строи</h2>
            <ul id="upcomingParadesList" class="bg-white p-6 rounded-lg shadow-md">
                </ul>
        </div>

        <div id="manage-staff" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Управление составом</h2>
            <div class="flex justify-between items-center mb-4">
                <button onclick="openModal('addAccountModal')" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">Добавить аккаунт</button>
                <div>
                    <label for="position-filter" class="mr-2">Фильтр по должности:</label>
                    <select id="position-filter" class="p-2 border rounded"></select>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Никнейм</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Должность</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Последняя активность</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                        </tr>
                    </thead>
                    <tbody id="accountsTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="manage-certifications" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Управление аттестациями</h2>
            <button onclick="openModal('addTestModal')" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 mb-4">Создать новый тест</button>
            <ul id="testsList" class="bg-white p-6 rounded-lg shadow-md">
                </ul>
        </div>

        <div id="manage-parades" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Управление строями</h2>
            <button onclick="openModal('addParadeModal')" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 mb-4">Запланировать строй</button>
            <ul id="paradesList" class="bg-white p-6 rounded-lg shadow-md">
                </ul>
        </div>

        <div id="manage-candidates" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Кандидаты на начальника</h2>
            <ul id="candidatesList" class="bg-white p-6 rounded-lg shadow-md">
                </ul>
        </div>

        <div id="certification-results" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Результаты аттестаций</h2>
            <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сотрудник</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тест</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата прохождения</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Результат</th>
                            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Мои отчеты и неактивы</h2>
            <div class="flex mb-4">
                <button onclick="openModal('reportModal')" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 mr-4">Подать отчет</button>
                <button onclick="openModal('inactiveModal')" class="bg-orange-500 text-white py-2 px-4 rounded hover:bg-orange-600">Оставить неактив</button>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h3 class="text-lg font-semibold mb-2">Мои отчеты</h3>
                <ul id="myReportsList"></ul>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-2">Мои неактивы</h3>
                <ul id="myInactivesList"></ul>
            </div>
        </div>

        <div id="orls-reports" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Все заявления и неактивы</h2>
            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h3 class="text-lg font-semibold mb-2">Заявления</h3>
                <ul id="allReportsList"></ul>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-2">Неактивы</h3>
                <ul id="allInactivesList"></ul>
            </div>
        </div>

        <div id="weekly-reports" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Отчеты за неделю</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700">Пройдено аттестаций</h3>
                    <p id="weeklyCertifications" class="text-3xl font-bold text-purple-500 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700">Заявлений</h3>
                    <p id="weeklyReports" class="text-3xl font-bold text-blue-500 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700">Неактивов</h3>
                    <p id="weeklyInactives" class="text-3xl font-bold text-orange-500 mt-2">0</p>
                </div>
            </div>
            <h3 class="text-lg font-semibold mb-2">Активность</h3>
            <ul id="weeklyActivityList" class="bg-white p-6 rounded-lg shadow-md">
                </ul>
        </div>

        <div id="certification" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Аттестация</h2>
            <ul id="traineeTestsList" class="bg-white p-6 rounded-lg shadow-md">
                </ul>
        </div>
    </div>

    <div id="addAccountModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Добавить аккаунт</h2>
            <form id="addAccountForm">
                <div class="mb-4">
                    <label class="block text-gray-700">Никнейм:</label>
                    <input type="text" name="nickname" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Роль:</label>
                    <input type="text" name="role" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Код авторизации:</label>
                    <input type="password" name="auth_code" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Специальный код:</label>
                    <input type="password" name="special_code" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('addAccountModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                    <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded">Добавить</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editAccountModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Редактировать аккаунт</h2>
            <form id="editAccountForm">
                <input type="hidden" id="editAccountId">
                <div class="mb-4">
                    <label class="block text-gray-700">Никнейм:</label>
                    <input type="text" id="editAccountNickname" name="nickname" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Роль:</label>
                    <input type="text" id="editAccountRole" name="role" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Код авторизации:</label>
                    <input type="password" id="editAccountCode" name="auth_code" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Специальный код:</label>
                    <input type="password" id="editSpecialCode" name="special_code" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="flex justify-between items-center">
                    <button type="button" onclick="openModal('assignTestModal')" class="bg-purple-500 text-white py-2 px-4 rounded">Назначить тест</button>
                    <div>
                        <button type="button" onclick="closeModal('editAccountModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                        <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded">Сохранить</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="assignTestModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Назначить аттестацию</h2>
            <form id="assignTestForm">
                <input type="hidden" id="assignTestAccountId">
                <div class="mb-4">
                    <label class="block text-gray-700">Выберите тест:</label>
                    <select id="assignTestSelect" class="shadow border rounded w-full py-2 px-3" required></select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Время на прохождение (минут):</label>
                    <input type="number" id="testTimeInput" name="testTime" class="shadow border rounded w-full py-2 px-3" value="15" required>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('assignTestModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                    <button type="submit" class="bg-purple-500 text-white py-2 px-4 rounded">Назначить</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addTestModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Создать новый тест</h2>
            <form id="addTestForm">
                <div class="mb-4">
                    <label class="block text-gray-700">Название теста:</label>
                    <input type="text" name="testName" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Описание:</label>
                    <textarea name="description" class="shadow border rounded w-full py-2 px-3" rows="3" required></textarea>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('addTestModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                    <button type="submit" class="bg-green-500 text-white py-2 px-4 rounded">Создать</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editTestModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-2xl max-h-screen overflow-y-auto">
            <h2 class="text-2xl font-bold mb-4">Редактировать тест: <span id="editTestName"></span></h2>
            <div id="questionsContainer" class="mb-4">
                </div>
            <div class="mb-4">
                <button type="button" onclick="addQuestion()" class="bg-blue-500 text-white py-2 px-4 rounded">Добавить вопрос</button>
            </div>
            <div class="flex justify-end">
                <button type="button" onclick="closeModal('editTestModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                <button type="button" onclick="saveEditedTest()" class="bg-green-500 text-white py-2 px-4 rounded">Сохранить</button>
            </div>
        </div>
    </div>

    <div id="addParadeModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Запланировать строй</h2>
            <form id="addParadeForm">
                <div class="mb-4">
                    <label class="block text-gray-700">Подразделение:</label>
                    <input type="text" name="department" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Время строя:</label>
                    <input type="time" name="paradeTime" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Текст строя:</label>
                    <textarea name="paradeText" class="shadow border rounded w-full py-2 px-3" rows="3" required></textarea>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('addParadeModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                    <button type="submit" class="bg-green-500 text-white py-2 px-4 rounded">Запланировать</button>
                </div>
            </form>
        </div>
    </div>

    <div id="reportModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Подать отчет</h2>
            <form id="reportForm">
                <input type="hidden" id="reportUserRole">
                <div class="mb-4">
                    <label class="block text-gray-700">Тема:</label>
                    <input type="text" name="reportSubject" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Текст отчета:</label>
                    <textarea name="reportText" class="shadow border rounded w-full py-2 px-3" rows="5" required></textarea>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('reportModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                    <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded">Отправить</button>
                </div>
            </form>
        </div>
    </div>

    <div id="inactiveModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">Оставить неактив</h2>
            <form id="inactiveForm">
                <div class="mb-4">
                    <label class="block text-gray-700">Дата начала:</label>
                    <input type="date" name="startDate" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Дата окончания:</label>
                    <input type="date" name="endDate" class="shadow border rounded w-full py-2 px-3" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700">Причина:</label>
                    <textarea name="reason" class="shadow border rounded w-full py-2 px-3" rows="3" required></textarea>
                </div>
                <div class="flex justify-end">
                    <button type="button" onclick="closeModal('inactiveModal')" class="bg-gray-500 text-white py-2 px-4 rounded mr-2">Отмена</button>
                    <button type="submit" class="bg-orange-500 text-white py-2 px-4 rounded">Отправить</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>
